name: macos-clang

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: macos-12

    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive
      
      - name: Install mpi
        run: brew install open-mpi netcdf

      - name: Configure and build
        run: |
          source ./machines/macos-clang.sh &&
          cd build &&
          ./cmakescript.sh &&
          cmake --build .

      - name: Test
        #working-directory: ${{github.workspace}}/build
        run: ctest

